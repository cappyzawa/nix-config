#!/bin/bash

PLUGIN_DIR="$CONFIG_DIR/plugins"

# Color palette (Tokyo Night inspired)
BAR_COLOR=0xf02c2e34
ICON_COLOR=0xffe2e2e3
LABEL_COLOR=0xffe2e2e3
ACCENT_COLOR=0xff7aa2f7
GREEN=0xff9ece6a
YELLOW=0xffe0af68
RED=0xfff7768e
ORANGE=0xffff9e64

# Bar appearance
sketchybar --bar \
  height=32 \
  blur_radius=30 \
  position=top \
  sticky=on \
  padding_left=8 \
  padding_right=8 \
  color=$BAR_COLOR

# Default item settings
sketchybar --default \
  icon.font="SF Pro:Bold:14.0" \
  icon.color=$ICON_COLOR \
  label.font="SF Pro:Semibold:13.0" \
  label.color=$LABEL_COLOR \
  padding_left=4 \
  padding_right=4 \
  background.height=26 \
  background.corner_radius=6

# ===== Left side =====

# Apple logo
sketchybar --add item apple left \
  --set apple \
    icon=􀣺 \
    icon.font="SF Pro:Black:16.0" \
    icon.color=$ACCENT_COLOR \
    label.drawing=off \
    click_script="open -a 'System Settings'"

# Front app
sketchybar --add item front_app left \
  --set front_app \
    icon.drawing=off \
    label.font="SF Pro:Bold:13.0" \
    script="$PLUGIN_DIR/front_app.sh" \
  --subscribe front_app front_app_switched

# ===== Right side =====

# Clock
sketchybar --add item clock right \
  --set clock \
    icon=􀐫 \
    icon.color=$ACCENT_COLOR \
    update_freq=30 \
    script="$PLUGIN_DIR/clock.sh"

# Battery
sketchybar --add item battery right \
  --set battery \
    icon.color=$GREEN \
    update_freq=120 \
    script="$PLUGIN_DIR/battery.sh" \
  --subscribe battery system_woke power_source_change

# Volume
sketchybar --add item volume right \
  --set volume \
    icon.color=$YELLOW \
    script="$PLUGIN_DIR/volume.sh" \
  --subscribe volume volume_change

# Network speed
sketchybar --add item network right \
  --set network \
    icon=􀤆 \
    icon.color=$ORANGE \
    label="-- KB/s" \
    update_freq=2 \
    script="$PLUGIN_DIR/network.sh"

# Keyboard (input source)
sketchybar --add item keyboard right \
  --set keyboard \
    icon=􀇳 \
    icon.color=$ACCENT_COLOR \
    update_freq=5 \
    script="$PLUGIN_DIR/keyboard.sh" \
  --subscribe keyboard input_change

# Force all scripts to run
sketchybar --update
